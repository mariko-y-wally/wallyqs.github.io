<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Posts &ndash;
    
    Waldemar Quevedo
  </title>

  <meta name="author" content="Waldemar Quevedo" />
  <meta name="description" content="PaaS, Org mode, living in Tokyo & other misc writings." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="http://gravatar.com/avatar/210dbb68c0380da4d77ff46759f02d1a?s=150" height="75" width="75" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Waldemar</span>
        <span id="lname">Quevedo</span>
      </a>
    </section>

    <section class="description">
      <p>
        PaaS, Org mode, living in Tokyo & other misc writings.
      </p>
    </section>

    <section class="meta">
      <a href="https://github.com/wallyqs" target="_blank"><i class="icon icon-github"></i></a>
      <a href="https://twitter.com/wallyqs" target="_blank"><i class="icon icon-twitter"></i></a>
      <a href="/atom.xml"><i class="icon icon-rss"></i></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/about.html">about</a></li>
        <li><a href="/posts.html">posts</a></li>
      </ul>
    </section>
  </section>

  <section class="content">
  
  <h1>
    <a href="/posts/introducing-re-org">Introducing re-org: tool for generating templates for Org mode</a>
  </h1>
  <section class="byline">
    December  8, 2013
  </section>
  
<p>I have written a small utility named <a href="https://github.com/wallyqs/re-org">re-org</a> that could be useful for
  when writing posts in Jekyll.</p>
<h2>Creating a new post with <code>re-org</code></h2>
<p>For example, we can create a new Jekyll post like this:</p>
<div class="highlight"><pre>re-org new jekyll-post --title=sample-post

Created a new writing at `/home/wallyqs/repos/jekyll-org-blog/_drafts/2013-12-08-sample-post.org&#39;
</pre></div>
<p>The generated file will include some required attributes to be able to
  publish content when using Jekyll.</p>
<div class="highlight"><pre>#+title:         Sample post
#+date:          2013-12-08
#+layout:        post
#+category:      posts
</pre></div>
<p>By including <a href="https://gist.github.com/wallyqs/7857206">this plugin</a> within the <code>_plugins</code> directory from Jekyll,
  we can just use Org mode buffer settings instead of having to add
  <code>YAML</code> as we are usually supposed to do when using
  Jekyll.</p>
<p><code>re-org new</code> creates the file in the <code>_drafts</code> directory,
  so we need to run <code>jekyll server --drafts</code> in case we want to see the preview.
  For publishing, we just move it to the <code>_posts</code> directory, then
  <code>jekyll server</code> to render them.</p>
<div class="highlight"><pre>mv _drafts/2013-12-08-sample-post.org _posts

jekyll server
</pre></div>
<h2>Adding a new template</h2>
<p>You can modify the default templates from <code>re-org</code> by creating a
  <code>_templates</code> directory within the Jekyll project.
  The default templates can be inspected like this:</p>
<div class="highlight"><pre>re-org templates 

- clockfile.org
- jekyll-post.org
- notebook.org
- writing.org

re-org templates --name<span class="o">=</span>jekyll-post.org
<span class="c">#+title:         &lt;%= @org[:title].capitalize.gsub(&quot;-&quot;, &quot; &quot;) %&gt;</span>
<span class="c">#+date:          &lt;%= @org[:date] %&gt;</span>
<span class="c">#+layout:        post</span>
<span class="c">#+category:      posts</span>
</pre></div>
<p>We&#8217;ll use the contents from the <code>jekyll-post.org</code> template and create
  a new one:</p>
<div class="highlight"><pre>mkdir _templates
re-org templates --name<span class="o">=</span>jekyll-post.org &gt; _templates/post.org

re-org templates
* Default Templates

- clockfile.org <span class="o">(</span>default<span class="o">)</span>
- jekyll-post.org       <span class="o">(</span>default<span class="o">)</span>
- notebook.org  <span class="o">(</span>default<span class="o">)</span>
- writing.org   <span class="o">(</span>default<span class="o">)</span>
- post.org      <span class="o">(</span>found at _templates/<span class="o">)</span>
</pre></div>
<p>As we can see, <code>ERB</code> tags can be used to modify the content of the
  template that will be used. Having done that, we can use it to setup
  the template for the next writing:</p>
<div class="highlight"><pre>re-org new post --title<span class="o">=</span>getting-started-with-jekyll-and-org-mode
Created a new writing at <span class="sb">`</span>/home/wallyqs/repos/jekyll-org-blog/_drafts/2013-12-08-getting-started-with-jekyll-and-org-mode.org<span class="err">&#39;</span>


cat _drafts/2013-12-08-getting-started-with-jekyll-and-org-mode.org
<span class="c">#+title:         Getting started with jekyll and org mode</span>
<span class="c">#+date:          2013-12-08</span>
<span class="c">#+layout:        post</span>
<span class="c">#+category:      posts</span>
</pre></div>
<p>I&#8217;m satisfied with the current state of the <code>re-org</code> utility so I have
  released as a gem as well. It definitely needs more polish but the
  basic idea is there.</p>
<p>To install:</p>
<div class="highlight"><pre>gem install re-org
</pre></div>
<p>If you find this remotely useful, please don&#8217;t hesitate to submit a
  ticket in Github: <a href="https://github.com/wallyqs/re-org/issues">https://github.com/wallyqs/re-org/issues</a></p>



  <hr />
  
  <h1>
    <a href="/posts/jekyll-without-yaml">Replacing Jekyll YAML headers with Org mode buffer settings</a>
  </h1>
  <section class="byline">
    December  6, 2013
  </section>
  
<p>I took a quick look at what would be required
  to avoid having to use <code>YAML</code> headers for Jekyll and using
  only Org mode buffer settings to set the layout, title
  from a Jekyll post.</p>
<div class="highlight"><pre><span class="k">module</span> <span class="nn">Jekyll</span>
 <span class="k">class</span> <span class="nc">Post</span>
    <span class="k">def</span> <span class="nf">read_yaml</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{})</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read_with_options</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">),</span>
                                            <span class="n">merged_file_read_opts</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">data</span> <span class="o">||=</span> <span class="p">{}</span>

      <span class="n">org_text</span> <span class="o">=</span> <span class="no">Orgmode</span><span class="o">::</span><span class="no">Parser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
      <span class="n">org_text</span><span class="o">.</span><span class="n">in_buffer_settings</span><span class="o">.</span><span class="n">each_pair</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="n">key</span><span class="o">.</span><span class="n">downcase</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
      <span class="k">end</span>

      <span class="nb">self</span><span class="o">.</span><span class="n">extracted_excerpt</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">extract_excerpt</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">&quot;Error converting file </span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p>This way, instead of having to write</p>
<div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">something</span>
<span class="nn">---</span>
</pre></div>
<p>I can just continue to use Org mode syntax:</p>
<div class="highlight"><pre><span class="c1">#+title: Replacing Jekyll YAML headers with Org mode buffer settings</span>
</pre></div>
<p>My fork of <code>jekyll-org</code> which has this feature enabled is <a href="https://github.com/wallyqs/jekyll-org/blob/54e1e19697e12d73e9765fb96db37522666af274/convert.rb">here</a>.</p>
<h2>Update [2013-12-07 Sat]</h2>
<p>I did some modifications again to plugin for converting Org mode
  texts:</p>
<ul>
  <li>Disable using Liquid tags and rely mostly on Org mode syntax for
    exporting</li>
  <li>Remove the <code>#+TITLE</code> from in buffer settings to exporting it 2 times
    with different styles</li>
</ul>
<p>The resulting plugin is here:</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;org-ruby&#39;</span>

<span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="c1"># This overrides having to use YAML in the posts</span>
  <span class="c1"># and instead use in buffer settings from Org mode</span>
  <span class="k">class</span> <span class="nc">Post</span>
    <span class="k">def</span> <span class="nf">read_yaml</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{})</span>
      <span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read_with_options</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">),</span>
                                       <span class="n">merged_file_read_opts</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">data</span> <span class="o">||=</span> <span class="p">{}</span>

      <span class="n">org_text</span> <span class="o">=</span> <span class="no">Orgmode</span><span class="o">::</span><span class="no">Parser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
      <span class="n">org_text</span><span class="o">.</span><span class="n">in_buffer_settings</span><span class="o">.</span><span class="n">each_pair</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
        <span class="c1"># Remove #+TITLE from the buffer settings to avoid double exporting</span>
        <span class="n">org_text</span><span class="o">.</span><span class="n">in_buffer_settings</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="o">=~</span> <span class="sr">/title/i</span>
        <span class="n">buffer_setting</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">downcase</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="n">buffer_setting</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
      <span class="k">end</span>

      <span class="c1"># Disable Liquid tags from the output</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">ORG</span>
<span class="sh">{％ raw ％}</span>
<span class="sh">#{org_text.to_html}</span>
<span class="sh">{％ endraw ％}</span>
<span class="no">ORG</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">extracted_excerpt</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">extract_excerpt</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">&quot;Error converting file </span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Based from https://github.com/eggcaker/jekyll-org</span>
  <span class="k">class</span> <span class="nc">OrgConverter</span> <span class="o">&lt;</span> <span class="no">Converter</span>
    <span class="n">safe</span> <span class="kp">true</span>
    <span class="n">priority</span> <span class="ss">:low</span>

    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
      <span class="n">ext</span> <span class="o">=~</span> <span class="sr">/org/i</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">output_ext</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
      <span class="s2">&quot;.html&quot;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
      <span class="n">content</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">Filters</span>
    <span class="k">def</span> <span class="nf">restify</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
      <span class="n">site</span> <span class="o">=</span> <span class="vi">@context</span><span class="o">.</span><span class="n">registers</span><span class="o">[</span><span class="ss">:site</span><span class="o">]</span>
      <span class="n">converter</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">getConverterImpl</span><span class="p">(</span><span class="no">Jekyll</span><span class="o">::</span><span class="no">OrgConverter</span><span class="p">)</span>
      <span class="n">converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>



  <hr />
  
  <h1>
    <a href="/posts/simple-express-webapp">Example of a simple web app with express</a>
  </h1>
  <section class="byline">
    November 26, 2013
  </section>
  
<h1>Building a simple web app with express</h1>
<blockquote>
  <p>The following is an Org babel document from a long time ago,
    though I publish it anyway. Raw Org babel content can be fetch from here:
    <a href="https://raw.github.com/wallyqs/org_writings/master/express_app/babel.org">https://raw.github.com/wallyqs/org_writings/master/express_app/babel.org</a></p>
</blockquote>
<h2>Scaffolding the app</h2>
<div class="highlight"><pre>~/node_modules/express/bin/express
</pre></div>
<div class="highlight"><pre>create : .
create : ./package.json
create : ./app.js
create : ./public
create : ./public/javascripts
create : ./public/images
create : ./public/stylesheets
create : ./public/stylesheets/style.css
create : ./routes
create : ./routes/index.js
create : ./views
create : ./views/layout.jade
create : ./views/index.jade

install dependencies:
  $ cd . &amp;&amp; npm install

run the app:
  $ node app
</pre></div>
<p>For this app, I want to customize things a bit and have a <code>controllers</code> folder,
  instead of using the <code>routes</code> folder created when scaffolding the app.</p>
<div class="highlight"><pre>mkdir controllers
rm -rf routes
</pre></div>
<h2>Dependencies: package.json</h2>
<p>The project will be built using latest <code>express</code> web framework,
  <code>swig</code> for templates given its similarity to Django templates,
  and <code>mongoose</code> as the ORM for MongoDB.</p>
<p>We also include the <code>consolidate</code> module as a workaround to
  make <code>swig</code> templates to work with latest express.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;simple-express-app&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;private&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;node app&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;express&quot;</span><span class="o">:</span> <span class="s2">&quot;3.0.0beta6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;swig&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;consolidate&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mongoose&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>Installing the dependencies</h2>
<p>A Node.js project includes its dependencies
  along with the project under the <code>node_modules</code> directory.</p>
<div class="highlight"><pre>npm install

ls node_modules
</pre></div>
<p>and confirm that the following modules exist:</p>
<div class="highlight"><pre>consolidate express mongoose swig 
</pre></div>
<h2>Bootstrapping: app.js</h2>
<p>This is were we build up the app and start the server.</p>
<h3>Require application dependencies</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">express</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">fs</span>          <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">swig</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;swig&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">cons</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;consolidate&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">mongoose</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">http</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">app</span>		<span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</pre></div>
<h3>Connect to MongoDB</h3>
<p>Create the connection to MongoDB on startup:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">&#39;mongodb-1.8&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;credentials&#39;</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;hostname&quot;</span><span class="o">:</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;db&quot;</span><span class="o">:</span><span class="s2">&quot;simple_express_app&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">&quot;mongodb://&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;mongodb://&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">));</span>
</pre></div>
<h3>Configuration</h3>
<p>In order for this to work in latest express <code>swig</code>,
  we have to explicitly say that we are using <code>swig</code> as
  the template engine for <code>.html</code> files, initialize it,
  and then use <code>consolidate</code> to enable it.</p>
<p>Notice that we have to set <code>allowErrors</code> to <code>true</code>,
  otherwise a <i>Circular extends found</i> error will be thrown
  when using template inheritance.</p>
<div class="highlight"><pre><span class="nx">swig</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">root</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">,</span>
    <span class="nx">allowErrors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">autoescape</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="nx">cons</span><span class="p">.</span><span class="nx">swig</span><span class="p">);</span>
</pre></div>
<p>Here we include some commonly use middleware used for <code>express</code> apps.
  Also we set the views directory by using the <code>swig.root</code> that
  we previously set.</p>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">swig</span><span class="p">.</span><span class="nx">root</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">favicon</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
<p>Only show errors in development.</p>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>
<h3>Load the controllers</h3>
<p>We have to load all the controllers manually by globbing
  the <code>controllers</code> directory we created.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Controllers</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/controllers&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">Controllers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/controllers/&#39;</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<h3>Routes of the application</h3>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span>		<span class="p">,</span> <span class="nx">Controllers</span><span class="p">.</span><span class="nx">home</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/texts/create&#39;</span>	<span class="p">,</span> <span class="nx">Controllers</span><span class="p">.</span><span class="nx">texts</span><span class="p">.</span><span class="nx">create</span><span class="p">);</span>
</pre></div>
<h3>Starting the server!</h3>
<div class="highlight"><pre><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port &quot;</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
<h2>The Models</h2>
<p>We will use <code>mongoose</code> to set up the models of the application.</p>
<div class="highlight"><pre>mkdir models
</pre></div>
<h3>Model :: Text</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">Schema</span>   <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">textSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span>	<span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">,</span> <span class="nx">content</span><span class="o">:</span>	<span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span> <span class="p">}</span>
  <span class="p">,</span> <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span> <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="nx">textSchema</span><span class="p">);</span>
</pre></div>
<h2>The Controllers</h2>
<h3>Scaffolding the controllers</h3>
<p>We have to create a directory for the views from each
  controller since it was not created during the initial scaffold:</p>
<div class="highlight"><pre>mkdir controllers/home
</pre></div>
<h3>Action :: Home#index</h3>
<p>This points to the root of the application.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Text</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/text.js&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">Text</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">texts</span><span class="p">){</span>    
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;home/index&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">page_title</span><span class="o">:</span> <span class="s1">&#39;Texts&#39;</span><span class="p">,</span> <span class="nx">texts</span><span class="o">:</span> <span class="nx">texts</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>
<h3>Action :: Text#create</h3>
<p>This creates a new Text.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Text</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/text.js&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">({</span> <span class="nx">page_title</span><span class="o">:</span> <span class="s2">&quot;Example&quot;</span>
                   <span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">&quot;Lorem ipsum dolor...&quot;</span> 
                  <span class="p">});</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Something went wrong:&#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Created a new text.&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<h2>The Views</h2>
<h3>The Layout</h3>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>{% block page_title %}{% endblock %}<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;/stylesheets/style.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  {% block body %}{% endblock %}
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<h3>Template :: Home#index</h3>
<div class="highlight"><pre>{% extends &#39;layout.html&#39; %}

{% block body %}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span> {{ page_title }} <span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;p&gt;</span> Current Texts
    <span class="nt">&lt;ol&gt;</span>
      {% for text in texts %}
      <span class="nt">&lt;li&gt;</span>{{ text.title }}<span class="nt">&lt;/li&gt;</span>
      {% endfor %}    
    <span class="nt">&lt;/ol&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
{% endblock %}
</pre></div>
<h2>Running the app</h2>
<div class="highlight"><pre>node app.js
</pre></div>
<h1>Links</h1>
<ul>
  <li>Express example apps
    <a href="https://github.com/visionmedia/express/tree/master/examples">https://github.com/visionmedia/express/tree/master/examples</a></li>
  <li>Comparison among Node.js template technologies
    <a href="http://paularmstrong.github.com/node-templates/">http://paularmstrong.github.com/node-templates/</a></li>
  <li>Example of using mongoose for the schema
    <a href="https://github.com/LearnBoost/mongoose/blob/master/examples/schema.js">https://github.com/LearnBoost/mongoose/blob/master/examples/schema.js</a></li>
  <li>Connecting to MongoDB in Cloudfoundry
    <a href="http://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html">http://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html</a></li>
  <li>Gist with examples about how to use mongoose
    <a href="https://gist.github.com/1025038">https://gist.github.com/1025038</a></li>
</ul>



  <hr />
  
  <h1>
    <a href="/posts/rakuten-tech-conf">Rakuten Tech Conf</a>
  </h1>
  <section class="byline">
    November 25, 2013
  </section>
  
<h1>Gave a presentation at the Rakuten Tech Conference 2013</h1>
<p>Last month, I gave presentation at the
  <a href="http://tech.rakuten.co.jp/">Rakuten Tech Conf</a> to talk a little bit of how it has resulted to us
  having an internal platform as a service to make teams</p>
<p>After watching the video, I see that I had a lot of misplaced
  confidence with the English I speak&#8230; I&#8217;m mispronouncing tons of words
  and overall I think there is a lot of room to improve&#8230;</p>
<p>In the end, it was a good experience to give this talk,
  and felt that it would be worth trying to get better at this
  by doing it more often. Need to get out of my comfort zone and maybe
  try doing these sort of things at local meetups.</p>
<p>The video of the talk has been finally been uploaded and can be
  watched here:</p>
<iframe width="560" height="315" src="//www.youtube.com/embed/oe1u0PjwW90?list=SPNVIqXmk6x8zlxVX0Cl-uHvEF9hycNcy6" frameborder="0" allowfullscreen></iframe>



  <hr />
  
  <h1>
    <a href="/posts/hello">Started to blog with Jekyll</a>
  </h1>
  <section class="byline">
    November 24, 2013
  </section>
  
<p>Starting a blog using the <a href="https://github.com/holman/left">Left</a> theme for <a href="https://github.com/mojombo/jekyll">Jekyll</a>.</p>
<p>Compared to other solutions, this uses the <code>org-ruby</code> parser
  to export <code>.org</code> files into HTML. You can check the source
  for this site here: <a href="https://github.com/wallyqs/wallyqs.github.io">https://github.com/wallyqs/wallyqs.github.io</a></p>
<div class="highlight"><pre><span class="nb">puts</span> <span class="s2">&quot;Syntax highlighting works!&quot;</span>
</pre></div>
<p>There are still some pending things that I would like to improve:</p>
<ul>
  <li>Use the <a href="https://github.com/wallyqs/re-org">re-org</a> tool to create and organize the posts that
    would finally go into the <code>_posts</code> directory for publishing.
    I think in the end using a YAML file would have been better than
    having to use environment variables.</li>
  <li>Try to extend or patch Jekyll so that I can avoid having to write:
<div class="highlight"><pre>---
layout: post
title:  Hello world
category: posts
---
</pre></div>
    <p>And instead cover this with Org syntax like:</p>
<div class="highlight"><pre>#+layout:   post
#+title:    Hello world
#+category: posts
</pre></div>
  </li>
</ul>
<p>Other than that, the setup promises to be very comfortable for
  writing, I&#8217;ll see how it goes.</p>



  <hr />
  
</section>

</body>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45988428-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</html>
