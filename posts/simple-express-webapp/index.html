<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Example of a simple web app with express &ndash;
    
    Waldemar Quevedo
  </title>

  <meta name="author" content="Waldemar Quevedo" />
  <meta name="description" content="PaaS, Org mode, living in Tokyo & other misc writings." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="http://gravatar.com/avatar/210dbb68c0380da4d77ff46759f02d1a?s=150" height="75" width="75" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Waldemar</span>
        <span id="lname">Quevedo</span>
      </a>
    </section>

    <section class="description">
      <p>
        PaaS, Org mode, living in Tokyo & other misc writings.
      </p>
    </section>

    <section class="meta">
      <a href="https://github.com/wallyqs" target="_blank"><i class="icon icon-github"></i></a>
      <a href="https://twitter.com/wallyqs" target="_blank"><i class="icon icon-twitter"></i></a>
      <a href="/atom.xml"><i class="icon icon-rss"></i></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/about.html">about</a></li>
        <li><a href="/posts.html">posts</a></li>
      </ul>
    </section>
  </section>

  <section class="content">
  <h1>
    <a href="/posts/simple-express-webapp">Example of a simple web app with express</a>
  </h1>

  <section class="byline">
    November 26, 2013
  </section>

  
<h1>Building a simple web app with express</h1>
<blockquote>
  <p>The following is an Org babel document from a long time ago,
    though I publish it anyway. Raw Org babel content can be fetch from here:
    <a href="https://raw.github.com/wallyqs/org_writings/master/express_app/babel.org">https://raw.github.com/wallyqs/org_writings/master/express_app/babel.org</a></p>
</blockquote>
<h2>Scaffolding the app</h2>
<div class="highlight"><pre>~/node_modules/express/bin/express
</pre></div>
<div class="highlight"><pre>create : .
create : ./package.json
create : ./app.js
create : ./public
create : ./public/javascripts
create : ./public/images
create : ./public/stylesheets
create : ./public/stylesheets/style.css
create : ./routes
create : ./routes/index.js
create : ./views
create : ./views/layout.jade
create : ./views/index.jade

install dependencies:
  $ cd . &amp;&amp; npm install

run the app:
  $ node app
</pre></div>
<p>For this app, I want to customize things a bit and have a <code>controllers</code> folder,
  instead of using the <code>routes</code> folder created when scaffolding the app.</p>
<div class="highlight"><pre>mkdir controllers
rm -rf routes
</pre></div>
<h2>Dependencies: package.json</h2>
<p>The project will be built using latest <code>express</code> web framework,
  <code>swig</code> for templates given its similarity to Django templates,
  and <code>mongoose</code> as the ORM for MongoDB.</p>
<p>We also include the <code>consolidate</code> module as a workaround to
  make <code>swig</code> templates to work with latest express.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;simple-express-app&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;private&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;node app&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;express&quot;</span><span class="o">:</span> <span class="s2">&quot;3.0.0beta6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;swig&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;consolidate&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mongoose&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>Installing the dependencies</h2>
<p>A Node.js project includes its dependencies
  along with the project under the <code>node_modules</code> directory.</p>
<div class="highlight"><pre>npm install

ls node_modules
</pre></div>
<p>and confirm that the following modules exist:</p>
<div class="highlight"><pre>consolidate express mongoose swig 
</pre></div>
<h2>Bootstrapping: app.js</h2>
<p>This is were we build up the app and start the server.</p>
<h3>Require application dependencies</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">express</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">fs</span>          <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">swig</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;swig&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">cons</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;consolidate&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">mongoose</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">http</span>	<span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">app</span>		<span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</pre></div>
<h3>Connect to MongoDB</h3>
<p>Create the connection to MongoDB on startup:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">&#39;mongodb-1.8&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;credentials&#39;</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;hostname&quot;</span><span class="o">:</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;db&quot;</span><span class="o">:</span><span class="s2">&quot;simple_express_app&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">&quot;mongodb://&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;mongodb://&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">));</span>
</pre></div>
<h3>Configuration</h3>
<p>In order for this to work in latest express <code>swig</code>,
  we have to explicitly say that we are using <code>swig</code> as
  the template engine for <code>.html</code> files, initialize it,
  and then use <code>consolidate</code> to enable it.</p>
<p>Notice that we have to set <code>allowErrors</code> to <code>true</code>,
  otherwise a <i>Circular extends found</i> error will be thrown
  when using template inheritance.</p>
<div class="highlight"><pre><span class="nx">swig</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">root</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">,</span>
    <span class="nx">allowErrors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">autoescape</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="nx">cons</span><span class="p">.</span><span class="nx">swig</span><span class="p">);</span>
</pre></div>
<p>Here we include some commonly use middleware used for <code>express</code> apps.
  Also we set the views directory by using the <code>swig.root</code> that
  we previously set.</p>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">swig</span><span class="p">.</span><span class="nx">root</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">favicon</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
<p>Only show errors in development.</p>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>
<h3>Load the controllers</h3>
<p>We have to load all the controllers manually by globbing
  the <code>controllers</code> directory we created.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Controllers</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/controllers&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">Controllers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/controllers/&#39;</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<h3>Routes of the application</h3>
<div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span>		<span class="p">,</span> <span class="nx">Controllers</span><span class="p">.</span><span class="nx">home</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/texts/create&#39;</span>	<span class="p">,</span> <span class="nx">Controllers</span><span class="p">.</span><span class="nx">texts</span><span class="p">.</span><span class="nx">create</span><span class="p">);</span>
</pre></div>
<h3>Starting the server!</h3>
<div class="highlight"><pre><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port &quot;</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
<h2>The Models</h2>
<p>We will use <code>mongoose</code> to set up the models of the application.</p>
<div class="highlight"><pre>mkdir models
</pre></div>
<h3>Model :: Text</h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">Schema</span>   <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">textSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span>	<span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">,</span> <span class="nx">content</span><span class="o">:</span>	<span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span> <span class="p">}</span>
  <span class="p">,</span> <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span> <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="nx">textSchema</span><span class="p">);</span>
</pre></div>
<h2>The Controllers</h2>
<h3>Scaffolding the controllers</h3>
<p>We have to create a directory for the views from each
  controller since it was not created during the initial scaffold:</p>
<div class="highlight"><pre>mkdir controllers/home
</pre></div>
<h3>Action :: Home#index</h3>
<p>This points to the root of the application.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Text</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/text.js&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">Text</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">texts</span><span class="p">){</span>    
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;home/index&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">page_title</span><span class="o">:</span> <span class="s1">&#39;Texts&#39;</span><span class="p">,</span> <span class="nx">texts</span><span class="o">:</span> <span class="nx">texts</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>
<h3>Action :: Text#create</h3>
<p>This creates a new Text.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Text</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/text.js&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">({</span> <span class="nx">page_title</span><span class="o">:</span> <span class="s2">&quot;Example&quot;</span>
                   <span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">&quot;Lorem ipsum dolor...&quot;</span> 
                  <span class="p">});</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Something went wrong:&#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Created a new text.&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<h2>The Views</h2>
<h3>The Layout</h3>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>{% block page_title %}{% endblock %}<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;/stylesheets/style.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  {% block body %}{% endblock %}
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<h3>Template :: Home#index</h3>
<div class="highlight"><pre>{% extends &#39;layout.html&#39; %}

{% block body %}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span> {{ page_title }} <span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;p&gt;</span> Current Texts
    <span class="nt">&lt;ol&gt;</span>
      {% for text in texts %}
      <span class="nt">&lt;li&gt;</span>{{ text.title }}<span class="nt">&lt;/li&gt;</span>
      {% endfor %}    
    <span class="nt">&lt;/ol&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
{% endblock %}
</pre></div>
<h2>Running the app</h2>
<div class="highlight"><pre>node app.js
</pre></div>
<h1>Links</h1>
<ul>
  <li>Express example apps
    <a href="https://github.com/visionmedia/express/tree/master/examples">https://github.com/visionmedia/express/tree/master/examples</a></li>
  <li>Comparison among Node.js template technologies
    <a href="http://paularmstrong.github.com/node-templates/">http://paularmstrong.github.com/node-templates/</a></li>
  <li>Example of using mongoose for the schema
    <a href="https://github.com/LearnBoost/mongoose/blob/master/examples/schema.js">https://github.com/LearnBoost/mongoose/blob/master/examples/schema.js</a></li>
  <li>Connecting to MongoDB in Cloudfoundry
    <a href="http://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html">http://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html</a></li>
  <li>Gist with examples about how to use mongoose
    <a href="https://gist.github.com/1025038">https://gist.github.com/1025038</a></li>
</ul>




  <section class="meta">
    <h3>Discussion, links, and tweets</h3>
    <section class="copy">
      <a href="https://twitter.com/wallyqs" target="_blank">
        <img src="http://gravatar.com/avatar/210dbb68c0380da4d77ff46759f02d1a?s=142" height="50" width="50" />
      </a>

      <p>
        I do Dev&amp;Ops at Rakuten in the Platform as a Service team, where I have focused
        on solving logging related issues as well as Ruby support.
        I'm also a contributor and current maintainer of the <a href="https://github.com/bdewey/org-ruby">org-ruby</a> gem, 
        in case you find some functionality missing please issue a ticket <a href="https://github.com/bdewey/org-ruby/issues">here</a>
        please. Thanks :)
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="wallyqs">Tweet</a>
      <a href="http://twitter.com/wallyqs" class="twitter-follow-button" data-show-count="false">Follow @wallyqs</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'wallyqs-blog'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </section>
</section>

</body>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45988428-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</html>
